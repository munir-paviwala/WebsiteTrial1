<!DOCTYPE html>
<html>
<head>
    <title>Baroda Industrial Growth Map</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        body { margin: 0; padding: 0; font-family: 'Helvetica', sans-serif; }
        #map { height: 100vh; width: 100%; background: #202020; }
        
        /* Control Button Style */
        .control-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: white;
            padding: 10px 20px;
            border: 2px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .control-btn:hover { background: #f0f0f0; }

        /* Legend Style */
        .legend {
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            line-height: 1.5em;
            color: #333;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            border-radius: 5px;
        }
        .legend i {
            width: 10px;
            height: 10px;
            float: left;
            margin-right: 8px;
            margin-top: 3px;
            border-radius: 50%;
        }

        /* Label Styles for Publication Mode */
        .leaflet-tooltip.pub-label {
            background-color: transparent;
            border: none;
            box-shadow: none;
            color: white;
            font-weight: bold;
            font-size: 14px;
            text-shadow: 
                -1px -1px 0 #000,  
                 1px -1px 0 #000,
                -1px  1px 0 #000,
                 1px  1px 0 #000; /* Black outline for readability on satellite */
        }
    </style>
</head>
<body>

<button class="control-btn" onclick="toggleMode()">Toggle Publication Mode</button>

<div id="map"></div>

<script>
    // 1. Initialize Map
    // We center slightly adjusted to frame all points well on satellite view
    var map = L.map('map').setView([22.3950, 73.1300], 13);

    // 2. Satellite Layer (Esri World Imagery)
    L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-GP, and the GIS User Community'
    }).addTo(map);

    // 3. Data Points (Updated Coordinates)
    var locations = [
        {
            name: "GSFC",
            year: "1962",
            coords: [22.3761, 73.1525],
            type: "giant",
            desc: "Pioneer fertilizer complex."
        },
        {
            name: "Koyali Refinery (IOCL)",
            year: "1965",
            coords: [22.3705, 73.1255],
            type: "giant",
            desc: "Anchor industry."
        },
        {
            name: "IPCL (Reliance VMD)",
            year: "1969",
            coords: [22.3700, 73.1100],
            type: "giant",
            desc: "Petrochemical catalyst."
        },
        {
            name: "GACL",
            year: "1973",
            coords: [22.4000, 73.1200],
            type: "giant",
            desc: "Caustic soda & chlorine."
        },
        {
            name: "Heavy Water Plant",
            year: "1977",
            coords: [22.371962, 73.159843], // UPDATED COORDINATE
            type: "giant",
            desc: "Strategic heavy water production."
        },
        {
            name: "Nandesari GIDC",
            year: "1975",
            coords: [22.4166, 73.0833],
            type: "estate",
            desc: "Downstream ecosystem."
        }
    ];

    // Store markers to access them for toggling
    var markers = [];

    // 4. Create Markers
    locations.forEach(function(loc) {
        var color = (loc.type === 'giant') ? '#ff3f34' : '#ffa502'; // Bright Red & Orange
        
        var circle = L.circleMarker(loc.coords, {
            color: 'white',
            weight: 2,
            fillColor: color,
            fillOpacity: 1, // Solid fill for satellite visibility
            radius: 10
        }).addTo(map);

        // Store data inside the marker object for easy access later
        circle.customData = loc;
        
        // Default Behavior: Bind Popup with Description
        circle.bindPopup(`<b>${loc.name}</b><br>Est. ${loc.year}<br><i>${loc.desc}</i>`);
        
        markers.push(circle);
    });

    // 5. Legend
    var legend = L.control({position: 'bottomright'});
    legend.onAdd = function (map) {
        var div = L.DomUtil.create('div', 'legend');
        div.innerHTML += '<i style="background: #ff3f34"></i> Major Complex<br>';
        div.innerHTML += '<i style="background: #ffa502"></i> Industrial Estate<br>';
        return div;
    };
    legend.addTo(map);


    // 6. Toggle Logic for "Publication Mode"
    var isPubMode = false;

    function toggleMode() {
        isPubMode = !isPubMode;
        
        markers.forEach(function(marker) {
            var data = marker.customData;

            if (isPubMode) {
                // PUBLICATION MODE
                marker.closePopup(); // Close any open clicks
                marker.unbindPopup(); // Disable clicking for description
                
                // Add permanent label
                marker.bindTooltip(`${data.name} (${data.year})`, {
                    permanent: true, 
                    direction: 'right',
                    className: 'pub-label',
                    offset: [10, 0]
                }).openTooltip();
                
            } else {
                // INTERACTIVE MODE
                marker.unbindTooltip(); // Remove permanent label
                
                // Re-enable popup with description
                marker.bindPopup(`<b>${data.name}</b><br>Est. ${data.year}<br><i>${data.desc}</i>`);
            }
        });
    }

</script>

</body>
</html>
